---
import { interpolate } from "flubber";
---

<div class="morphing-svg-container">
  <svg viewBox="0 0 100 100" class="morphing-shape">
    <path d="M20,20 L80,20 L80,80 L20,80 Z"></path>
  </svg>
</div>

<button id="morph-trigger">Morph Shape</button>

<style>
  .morphing-svg-container {
    width: 300px;
    height: 300px;
    margin: 50px auto;
  }

  .morphing-shape {
    width: 100%;
    height: 100%;
  }

  .morphing-shape path {
    fill: none;
    stroke: #3498db;
    stroke-width: 4;
  }

  button {
    display: block;
    margin: 20px auto;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #3498db;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  button:hover {
    background-color: #2980b9;
  }
</style>

<script>
  import { interpolate } from "flubber";

  const shapes = [
    "M20,20 L80,20 L80,80 L20,80 Z", // Square
    "M50,20 L80,80 L20,80 Z", // Triangle
    "M50,20 A30,30 0 0,1 80,50 A30,30 0 0,1 50,80 A30,30 0 0,1 20,50 A30,30 0 0,1 50,20 Z", // Circle
    "M20,50 Q50,20 80,50 T20,50", // Wave
  ];

  let currentShapeIndex = 0;

  const morphTrigger = document.getElementById("morph-trigger");
  const shapePath = document.querySelector(".morphing-shape path");

  morphTrigger?.addEventListener("click", () => {
    const nextIndex = (currentShapeIndex + 1) % shapes.length;
    const interpolator = interpolate(
      shapes[currentShapeIndex],
      shapes[nextIndex]
    );

    const start = performance.now();
    const duration = 1000; // 1 second

    function animate(time) {
      const elapsed = time - start;
      const progress = Math.min(elapsed / duration, 1);
      shapePath.setAttribute("d", interpolator(progress));

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        currentShapeIndex = nextIndex;
      }
    }

    requestAnimationFrame(animate);
  });
</script>
